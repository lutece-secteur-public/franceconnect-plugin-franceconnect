
#Module MyLutece pour FranceConnect

![](http://dev.lutece.paris.fr/plugins/module-mylutece-franceconnect/images/franceconnect.jpeg)

##Introduction

Ce module permet aux utilisateurs d'un site ou d'une application Lutece de s'authentifier via [FranceConnect](http://www.dev-franceconnect.fr) . Grâce à cette authentification, un fournisseur de service peut ensuite accéder à des ressourcesliées à l'utilisateur (et avec son consentement) via le protocole OpenID Connect.

#Installation

##Configuration

Vérifier dans le fichier `WEB-INF/conf/plugins/mylutece.properties` que l'authentification est bien activée comme suit :


```

# Enable authentication
mylutece.authentication.enable=true
    
mylutece.authentication.class=fr.paris.lutece.plugins.mylutece.modules.franceconnect.authentication.FranceConnectAuthentication

mylutece.url.login.page=Portal.jsp?page=franceconnect
mylutece.url.doLogout=servlet/plugins/mylutece/modules/franceconnect/logout
mylutece.url.default.redirect=../../Portal.jsp


```


Le fichier de context du module (WEB-INF/conf/plugins/mylutece-franceconnect_context.xml) doit ensuite être paramétré avec les informationsdu service client (id, secret et callback) :


```
           
 
    
<bean id="mylutece-franceconnect.server" class="fr.paris.lutece.plugins.mylutece.modules.franceconnect.oauth2.ServerConfiguration">
    <property name="issuer" value="http://fcp.integ01.dev-franceconnect.fr"/>
    <property name="authorizationEndpointUri"
                              value="https://fcp.integ01.dev-franceconnect.fr/api/v1/authorize"/>
    <property name="tokenEndpointUri" value="https://fcp.integ01.dev-franceconnect.fr/api/v1/token"/>
    <property name="userInfoUri" value="https://fcp.integ01.dev-franceconnect.fr/api/v1/userinfo"/>
    <property name="userInfoTokenMethod" value="HEADER"/>
</bean>

<bean id="mylutece-franceconnect.client" class="fr.paris.lutece.plugins.mylutece.modules.franceconnect.oauth2.RegisteredClient">
    <property name="clientId" value="  *** à renseigner ***  "/>
    <property name="clientSecret" value="  *** à renseigner ***  "/>
    <property name="scope">
        <set value-type="java.lang.String">
            <value>openid</value>
            <value>profile</value>
        </set>
    </property>
    <property name="tokenEndpointAuthMethod" value=""/>
    <property name="redirectUri" value=" *** à renseigner *** "/>
    <property name="redirectUris">
        <set>
            <value> *** à renseigner *** </value>
        </set>
    </property>
</bean>
    


```


##Usage

La page d'authentification FranceConnect s'appelle à partir de l'URL suivante :

 `http://myhost/lutece/jsp/site/Portal.jsp?page=franceconnect` 

Il est possible de réaliser ce formulaire d'authentification dans un portlet, soit en copiant le contenu du formulaire dans un portlet HTML, soit en modifiant la feuillede style XSL du portlet MyLutece.

##Dépannage


 
* Vérifiez bien la configuration de MyLutece comme indiqué ci-dessus.
* Assurez-vous que le module FranceConnect est le seul module MyLutece présent dans la Webapp. Il ne doit pas y avoir d'autres fichiers `mylutece-xxxxx.properties` dans le répertoire `WEB-INF/conf/plugins/` .
* L'activation des logs en mode debug se fait en ajoutant la ligne suivante dans le fichier `WEB-INF/conf/config.properties` dans la rubrique LOGGERS :

```

log4j.logger.lutece.franceconnect=DEBUG, Console

```





[Maven documentation and reports](http://dev.lutece.paris.fr/plugins/module-mylutece-franceconnect/)



 *generated by [xdoc2md](https://github.com/lutece-platform/tools-maven-xdoc2md-plugin) - do not edit directly.*